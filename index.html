<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Member Picker</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Sora:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-tertiary: #1a1a25;
      --accent-primary: #00f5d4;
      --accent-secondary: #7b2cbf;
      --accent-gradient: linear-gradient(135deg, #00f5d4 0%, #00bbf9 50%, #7b2cbf 100%);
      --text-primary: #ffffff;
      --text-secondary: #a0a0b0;
      --text-muted: #606070;
      --success: #00f5a0;
      --warning: #ffd60a;
      --danger: #ff6b6b;
      --border-color: #2a2a35;
      --shadow-glow: 0 0 40px rgba(0, 245, 212, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sora', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Background texture */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(123, 44, 191, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(0, 245, 212, 0.08) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      min-height: 100vh;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 3rem;
      position: relative;
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.02em;
      margin-bottom: 0.5rem;
    }

    .header p {
      color: var(--text-secondary);
      font-size: 1rem;
      font-weight: 300;
    }

    /* Main Layout */
    .main-layout {
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 2rem;
      align-items: start;
    }

    /* Panel Styles */
    .panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      overflow: hidden;
    }

    .panel-header {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-title {
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-secondary);
    }

    .panel-badge {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      padding: 0.25rem 0.75rem;
      background: var(--bg-tertiary);
      border-radius: 20px;
      color: var(--accent-primary);
    }

    /* User Table */
    .user-table {
      width: 100%;
      border-collapse: collapse;
    }

    .user-table th {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      text-align: left;
      padding: 1rem 1rem;
      background: var(--bg-tertiary);
    }

    .user-table td {
      padding: 0.875rem 1rem;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .user-table tr:last-child td {
      border-bottom: none;
    }

    .user-table tbody tr {
      transition: all 0.2s ease;
    }

    .user-table tbody tr:hover {
      background: var(--bg-tertiary);
    }

    .user-table tbody tr.done {
      opacity: 0.4;
    }

    .user-table tbody tr.done td {
      text-decoration: line-through;
    }

    .user-table tbody tr.active {
      background: rgba(0, 245, 212, 0.1);
    }

    .user-table tbody tr.active td:first-child {
      box-shadow: inset 3px 0 0 var(--accent-primary);
    }

    .user-code {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      color: var(--accent-primary);
    }

    /* Custom Checkbox */
    .checkbox-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .checkbox {
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      background: var(--bg-primary);
    }

    .checkbox:hover {
      border-color: var(--accent-primary);
    }

    .checkbox:checked {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .checkbox:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--bg-primary);
      font-size: 12px;
      font-weight: bold;
    }

    /* Session Panel */
    .session-panel {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* Timer Display */
    .timer-section {
      text-align: center;
      padding: 3rem 2rem;
    }

    .timer-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .timer-display {
      font-family: 'JetBrains Mono', monospace;
      font-size: 5rem;
      font-weight: 700;
      color: var(--text-primary);
      text-shadow: 0 0 60px rgba(0, 245, 212, 0.3);
      transition: all 0.3s ease;
    }

    .timer-display.warning {
      color: var(--warning);
      text-shadow: 0 0 60px rgba(255, 214, 10, 0.4);
    }

    .timer-display.danger {
      color: var(--danger);
      text-shadow: 0 0 60px rgba(255, 107, 107, 0.4);
      animation: pulse 1s ease infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Picker Display */
    .picker-section {
      padding: 2rem;
      text-align: center;
    }

    .picker-display {
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      border-radius: 16px;
      padding: 3rem 2rem;
      min-height: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .picker-display.spinning {
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-glow);
    }

    .picker-display.selected {
      border-color: var(--success);
      box-shadow: 0 0 40px rgba(0, 245, 160, 0.2);
    }

    .picker-placeholder {
      color: var(--text-muted);
      font-size: 1rem;
    }

    .picker-user {
      text-align: center;
    }

    .picker-user-code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.25rem;
      color: var(--accent-primary);
      margin-bottom: 0.5rem;
      opacity: 0.8;
    }

    .picker-user-name {
      font-size: 2.5rem;
      font-weight: 700;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .picker-status {
      margin-top: 1rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      animation: blink 1.5s ease infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Spin Animation Overlay */
    .spin-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-tertiary);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .spin-overlay.active {
      opacity: 1;
    }

    .spin-name {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Control Buttons */
    .controls {
      padding: 1.5rem 2rem 2rem;
      display: flex;
      gap: 1rem;
    }

    .btn {
      flex: 1;
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 12px;
      font-family: 'Sora', sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--accent-gradient);
      color: var(--bg-primary);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 245, 212, 0.3);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover:not(:disabled) {
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    .btn-danger {
      background: var(--danger);
      color: var(--text-primary);
    }

    .btn-danger:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
    }

    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .btn-icon {
      font-size: 1.1rem;
    }

    /* Progress Section */
    .progress-section {
      padding: 1.5rem 2rem;
      border-top: 1px solid var(--border-color);
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .progress-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .progress-count {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875rem;
      color: var(--accent-primary);
    }

    .progress-bar {
      height: 6px;
      background: var(--bg-tertiary);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent-gradient);
      border-radius: 3px;
      transition: width 0.5s ease;
      width: 0%;
    }

    /* Session Complete */
    .session-complete {
      display: none;
      text-align: center;
      padding: 3rem 2rem;
    }

    .session-complete.show {
      display: block;
    }

    .complete-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .complete-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--success);
      margin-bottom: 0.5rem;
    }

    .complete-subtitle {
      color: var(--text-secondary);
    }

    .complete-quote {
      margin-top: 1.5rem;
      padding: 1rem 1.5rem;
      background: var(--bg-tertiary);
      border-left: 3px solid var(--accent-primary);
      border-radius: 0 8px 8px 0;
      font-style: italic;
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.5;
      max-width: 500px;
      text-align: left;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      
      .timer-display {
        font-size: 3.5rem;
      }
    }

    /* Loading State for Table */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>Daily Member Picker</h1>
    </header>

    <div class="main-layout">
      <!-- Users Panel -->
      <div class="panel users-panel">
        <div class="panel-header">
          <span class="panel-title">Team Members</span>
          <span class="panel-badge" id="selectedCount">0 selected</span>
        </div>
        <table class="user-table">
          <thead>
            <tr>
              <th style="width: 50px; text-align: center;">âœ“</th>
              <th style="width: 50px; text-align: center;">ðŸ‘¤</th>
              <th>Trigram</th>
              <th style="width: 90px; text-align: center;">Duration</th>
            </tr>
          </thead>
          <tbody id="userTableBody">
            <tr>
              <td colspan="4" class="loading">Loading users...</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Session Panel -->
      <div class="panel session-panel">
        <!-- Timer -->
        <div class="timer-section">
          <div class="timer-label">Session Timer</div>
          <div class="timer-display" id="timerDisplay">15:00</div>
        </div>

        <!-- Picker Display -->
        <div class="picker-section">
          <div class="picker-display" id="pickerDisplay">
            <div class="picker-placeholder" id="pickerPlaceholder">
              Click "Start Session" to begin
            </div>
            <div class="picker-user" id="pickerUser" style="display: none;">
              <div class="picker-user-code" id="pickerUserCode"></div>
              <div class="picker-user-name-wrapper" style="display: flex; align-items: center; justify-content: center; gap: 0.75rem;">
                <span class="picker-user-avatar" id="pickerUserAvatar" style="font-size: 3rem; line-height: 1;"></span>
                <span class="picker-user-name" id="pickerUserName"></span>
              </div>
              <div class="picker-status">
                <span class="status-dot"></span>
                Speaking...
              </div>
            </div>
            <div class="spin-overlay" id="spinOverlay">
              <div class="spin-name" id="spinName"></div>
            </div>
          </div>

          <!-- Session Complete Message -->
          <div class="session-complete" id="sessionComplete">
            <div class="complete-icon">ðŸŽ‰</div>
            <div class="complete-title">Standup Complete!</div>
            <div class="complete-subtitle">All participants have spoken</div>
            <div class="complete-quote" id="completeQuote"></div>
          </div>
        </div>

        <!-- Controls -->
        <div class="controls">
          <button class="btn btn-primary" id="startBtn">
            <span class="btn-icon">â–¶</span>
            Start Session
          </button>
          <button class="btn btn-secondary" id="pickBtn" disabled style="display: none;">
            <span class="btn-icon">ðŸŽ²</span>
            Pick a member
          </button>
          <button class="btn btn-danger" id="resetBtn" style="display: none;">
            <span class="btn-icon">â†º</span>
            Reset
          </button>
        </div>

        <!-- Progress -->
        <div class="progress-section">
          <div class="progress-header">
            <span class="progress-label">Progress</span>
            <span class="progress-count" id="progressCount">0 / 0</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // State
    let users = [];
    let selectedUsers = [];
    let remainingUsers = [];
    let doneUsers = [];
    let currentUser = null;
    let sessionActive = false;
    let timerInterval = null;
    let timeRemaining = 15 * 60; // 15 minutes in seconds

    // DOM Elements
    const userTableBody = document.getElementById('userTableBody');
    const selectedCount = document.getElementById('selectedCount');
    const timerDisplay = document.getElementById('timerDisplay');
    const pickerDisplay = document.getElementById('pickerDisplay');
    const pickerPlaceholder = document.getElementById('pickerPlaceholder');
    const pickerUser = document.getElementById('pickerUser');
    const pickerUserCode = document.getElementById('pickerUserCode');
    const pickerUserName = document.getElementById('pickerUserName');
    const pickerUserAvatar = document.getElementById('pickerUserAvatar');
    const spinOverlay = document.getElementById('spinOverlay');
    const spinName = document.getElementById('spinName');
    const startBtn = document.getElementById('startBtn');
    const pickBtn = document.getElementById('pickBtn');
    const resetBtn = document.getElementById('resetBtn');
    const progressCount = document.getElementById('progressCount');
    const progressFill = document.getElementById('progressFill');
    const sessionComplete = document.getElementById('sessionComplete');

    // Funny avatar emojis (only single-character emojis to avoid duplicates)
    const avatarEmojis = [
      "ðŸ¦Š", "ðŸ¸", "ðŸµ", "ðŸ¦", "ðŸ¯", "ðŸ»", "ðŸ¼", "ðŸ¨", "ðŸ¦„", "ðŸ²",
      "ðŸ™", "ðŸ¦‹", "ðŸ¦€", "ðŸ¢", "ðŸ¦‰", "ðŸ¦‡", "ðŸº", "ðŸ¦ˆ", "ðŸ¡", "ðŸ¦‘",
      "ðŸ¤–", "ðŸ‘½", "ðŸ‘»", "ðŸŽƒ", "ðŸ¦–", "ðŸ¦•", "ðŸ‰", "ðŸ§™", "ðŸ§›", "ðŸ§Ÿ",
      "ðŸ¦¸", "ðŸ¦¹", "ðŸ¥¸", "ðŸ¤ ", "ðŸŽ…", "ðŸ°", "ðŸ¶", "ðŸ±", "ðŸ¦", "ðŸ¦¥"
    ];

    // Store assigned avatars for current session
    let memberAvatars = {};

    // Assign random avatars to all members
    function assignRandomAvatars() {
      const shuffled = [...avatarEmojis].sort(() => Math.random() - 0.5);
      users.forEach((_, index) => {
        memberAvatars[index] = shuffled[index % shuffled.length];
      });
    }

    // Programming quotes
    const quotes = [
      "There are only 10 types of people in the world: those who understand binary and those who don't.",
      "A programmer is someone who fixes a problem you didn't know you had in a way you don't understand.",
      "99 little bugs in the code, 99 little bugs. Take one down, patch it around, 127 little bugs in the code.",
      "The best thing about a boolean is that even if you're wrong, you're only off by a bit.",
      "Why do programmers prefer dark mode? Because light attracts bugs.",
      "A SQL query walks into a bar, walks up to two tables and asks, 'Can I join you?'",
      "There's no place like 127.0.0.1.",
      "Programming is like writing a book, except if you miss a single comma on page 126, the whole thing makes no sense.",
      "To understand recursion, you must first understand recursion.",
      "I would love to change the world, but they won't give me the source code.",
      "Software and cathedrals are much the same: first we build them, then we pray.",
      "It works on my machine.",
      "A programmer's wife tells him: 'Go to the store and buy a loaf of bread. If they have eggs, buy a dozen.' He comes home with 12 loaves of bread.",
      "Algorithm: a word programmers use when they don't want to explain what they did.",
      "The glass is neither half full nor half empty. The glass is twice as big as it needs to be.",
      "Debugging is like being the detective in a crime movie where you're also the murderer.",
      "In theory, there's no difference between theory and practice. In practice, there is.",
      "Real programmers count from zero.",
      "If at first you don't succeed, call it version 1.0.",
      "Hardware: the part of the computer that you can kick.",
      "Java is to JavaScript what car is to carpet.",
      "I don't always test my code, but when I do, I do it in production.",
      "The code that is the hardest to debug is the code that you know cannot possibly be wrong.",
      "Walking on water and developing software from a specification are easy if both are frozen.",
      "Any fool can write code that a computer can understand. Good programmers write code that humans can understand.",
      "If debugging is the process of removing bugs, then programming must be the process of putting them in.",
      "Software is like entropy: it's difficult to grasp, weighs nothing, and obeys the second law of thermodynamicsâ€”it always increases.",
      "Weeks of coding can save you hours of planning.",
      "Copy and paste is a design error.",
      "The first 90% of the code accounts for the first 90% of development time. The remaining 10% accounts for the other 90%.",
      "Documentation is like sex: when it's good, it's very good, and when it's bad, it's better than nothing.",
      "Deleted code is debugged code.",
      "A good programmer looks both ways before crossing a one-way street.",
      "Q: How do you tell an extroverted programmer from an introverted one? A: The extrovert looks at YOUR shoes while talking to you.",
      "The best performance improvement is the transition from the nonworking state to the working state.",
      "Measuring programming progress by lines of code is like measuring aircraft building progress by weight.",
      "Perfection is achieved not when there is nothing more to add, but when there is nothing left to take away... then management asks for more features.",
      "The best code is no code at all.",
      "Programming is 10% writing code and 90% figuring out why it doesn't work.",
      "There are two hard things in computer science: cache invalidation, naming things, and off-by-one errors.",
      "Always code as if the person who will maintain your code is a violent psychopath who knows where you live.",
      "I have not failed. I've just found 10,000 ways that won't compile.",
      "Give a man a program, frustrate him for a day. Teach a man to program, frustrate him for a lifetime.",
      "Software undergoes beta testing shortly before it's released. Beta is Latin for 'still doesn't work.'",
      "Every great developer you know got there by solving problems they were unqualified to solve until they actually did it.",
      "My code doesn't have bugs, it just develops random features.",
      "Q: Why do programmers hate nature? A: It has too many bugs and no documentation.",
      "Programmer: a machine that turns coffee into code.",
      "The only way to learn a new programming language is by writing programs in it and then crying.",
      "If the code and the comments disagree, then both are probably wrong.",
      "A user interface is like a joke. If you have to explain it, it's not that good.",
      "Q: Why do Java developers wear glasses? A: Because they can't C#.",
      "Some people, when confronted with a problem, think 'I know, I'll use regular expressions.' Now they have two problems.",
      "Software development is a race between programmers trying to build bigger idiot-proof programs and the universe trying to produce bigger idiots. So far, the universe is winning.",
      "The most dangerous phrase in programming: 'It's always worked this way.'",
      "Commenting your code is like cleaning your bathroom: you never want to do it, but it really does create a more pleasant experience for you and your guests.",
      "Q: What's a programmer's favorite hangout place? A: Foo Bar.",
      "It's not a bugâ€”it's an undocumented feature."
    ];

    // Users data (edit this array to add/remove team members)
    const usersData = [
      { "code": "THH", "firstName": "", "lastName": "" },
      { "code": "AUD", "firstName": "", "lastName": "" },
      { "code": "DMZ", "firstName": "", "lastName": "" },
      { "code": "JEP", "firstName": "", "lastName": "" },
      { "code": "MTM", "firstName": "", "lastName": "" },
      { "code": "NGT", "firstName": "", "lastName": "" },
      { "code": "ODC", "firstName": "", "lastName": "" },
      { "code": "OHX", "firstName": "", "lastName": "" },
      { "code": "TSN", "firstName": "", "lastName": "" },
      { "code": "THM", "firstName": "", "lastName": "" },
      { "code": "TDU", "firstName": "", "lastName": "" },
      { "code": "VML", "firstName": "", "lastName": "" }
    ];

    // Track speaking duration for each user (in seconds)
    let speakingDurations = {};
    let currentUserStartTime = null;

    // Load users
    function loadUsers() {
      users = usersData;
      // Assign random avatars
      assignRandomAvatars();
      // Select all users by default except THH and VML
      selectedUsers = users
        .map((user, index) => ({ user, index }))
        .filter(({ user }) => user.code !== 'THH' && user.code !== 'VML')
        .map(({ index }) => index);
      // Initialize speaking durations
      users.forEach((_, index) => {
        speakingDurations[index] = 0;
      });
      renderUserTable();
      updateSelectedCount();
    }

    // Format duration in mm:ss
    function formatDuration(seconds) {
      if (seconds === 0) return '-';
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // Render user table
    function renderUserTable() {
      userTableBody.innerHTML = users.map((user, index) => `
        <tr id="user-row-${index}" class="${doneUsers.includes(index) ? 'done' : ''} ${currentUser === index ? 'active' : ''}">
          <td>
            <div class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" 
                     id="check-${index}" 
                     data-index="${index}"
                     ${selectedUsers.includes(index) ? 'checked' : ''}
                     ${sessionActive ? 'disabled' : ''}
                     onchange="toggleUser(${index})">
            </div>
          </td>
          <td style="text-align: center; font-size: 1.5rem; line-height: 1;">${memberAvatars[index] || 'ðŸ‘¤'}</td>
          <td><span class="user-code">${user.code}</span></td>
          <td style="text-align: center; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--text-secondary);">${formatDuration(speakingDurations[index] || 0)}</td>
        </tr>
      `).join('');
      
      updateSelectedCount();
    }

    // Toggle user selection
    function toggleUser(index) {
      if (sessionActive) return;
      
      const idx = selectedUsers.indexOf(index);
      if (idx > -1) {
        selectedUsers.splice(idx, 1);
      } else {
        selectedUsers.push(index);
      }
      
      updateSelectedCount();
    }

    // Update selected count display
    function updateSelectedCount() {
      selectedCount.textContent = `${selectedUsers.length} selected`;
      updateProgress();
    }

    // Update progress bar (count current speaker as done)
    function updateProgress() {
      const total = selectedUsers.length;
      const done = Math.min(doneUsers.length + (currentUser !== null ? 1 : 0), total);
      progressCount.textContent = `${done} / ${total}`;
      const percentage = total > 0 ? (done / total) * 100 : 0;
      progressFill.style.width = `${percentage}%`;
    }

    // Format time display
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    // Update timer display with color states
    function updateTimerDisplay() {
      timerDisplay.textContent = formatTime(timeRemaining);
      timerDisplay.classList.remove('warning', 'danger');
      
      if (timeRemaining <= 60) {
        timerDisplay.classList.add('danger');
      } else if (timeRemaining <= 180) {
        timerDisplay.classList.add('warning');
      }
    }

    // Start timer
    function startTimer() {
      timerInterval = setInterval(() => {
        if (timeRemaining > 0) {
          timeRemaining--;
          updateTimerDisplay();
        } else {
          clearInterval(timerInterval);
        }
      }, 1000);
    }

    // Stop timer
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    // Start session
    function startSession() {
      if (selectedUsers.length === 0) {
        alert('Please select at least one participant');
        return;
      }

      sessionActive = true;
      remainingUsers = [...selectedUsers];
      doneUsers = [];
      currentUser = null;
      timeRemaining = 15 * 60;

      startBtn.style.display = 'none';
      resetBtn.style.display = 'flex';
      pickBtn.style.display = 'flex';
      pickBtn.disabled = false;
      sessionComplete.classList.remove('show');

      pickerPlaceholder.textContent = 'Click "Pick a member" to select first speaker';
      pickerUser.style.display = 'none';
      pickerDisplay.classList.remove('selected');

      renderUserTable();
      startTimer();
      updateProgress();
      
      // Automatically pick the first user
      spinAndPickUser();
    }

    // Spin animation for picking user
    async function spinAndPickUser() {
      // Save speaking duration for previous user immediately
      if (currentUser !== null && currentUserStartTime !== null) {
        const duration = Math.floor((Date.now() - currentUserStartTime) / 1000);
        speakingDurations[currentUser] = duration;
        renderUserTable();
      }

      // If this is the last user, end the session directly
      if (remainingUsers.length === 1 && currentUser !== null) {
        doneUsers.push(currentUser);
        remainingUsers = [];
        endSession();
        return;
      }

      if (remainingUsers.length === 0) {
        endSession();
        return;
      }

      pickBtn.disabled = true;
      pickerDisplay.classList.add('spinning');
      pickerDisplay.classList.remove('selected');
      spinOverlay.classList.add('active');
      pickerPlaceholder.style.display = 'none';
      pickerUser.style.display = 'none';

      // Animation duration: 1 second
      const duration = 1000;
      const startTime = Date.now();
      let spinInterval = 50;

      // Spinning animation
      const spin = () => {
        const elapsed = Date.now() - startTime;
        
        if (elapsed < duration) {
          // Pick random user to display
          const randomIdx = remainingUsers[Math.floor(Math.random() * remainingUsers.length)];
          const user = users[randomIdx];
          spinName.textContent = user.code;
          
          // Slow down near the end
          if (elapsed > duration * 0.7) {
            spinInterval = 100 + (elapsed - duration * 0.7) / 3;
          }
          
          setTimeout(spin, spinInterval);
        } else {
          // Final selection
          selectRandomUser();
        }
      };

      spin();
    }

    // Select random user after animation
    function selectRandomUser() {
      // Mark previous user as done
      if (currentUser !== null) {
        doneUsers.push(currentUser);
        remainingUsers = remainingUsers.filter(i => i !== currentUser);
      }

      if (remainingUsers.length === 0) {
        spinOverlay.classList.remove('active');
        pickerDisplay.classList.remove('spinning');
        endSession();
        return;
      }

      // Pick random from remaining
      const randomIndex = Math.floor(Math.random() * remainingUsers.length);
      currentUser = remainingUsers[randomIndex];
      currentUserStartTime = Date.now();
      const user = users[currentUser];

      // Update display
      spinOverlay.classList.remove('active');
      pickerDisplay.classList.remove('spinning');
      pickerDisplay.classList.add('selected');
      
      pickerUserCode.textContent = '';
      pickerUserAvatar.textContent = memberAvatars[currentUser];
      pickerUserName.textContent = user.code;
      pickerUser.style.display = 'block';
      
      pickBtn.disabled = false;
      
      // Update progress immediately when user starts speaking
      updateProgress();
      
      // Check if this is the last user - change button text
      if (remainingUsers.length === 1) {
        pickBtn.innerHTML = '<span class="btn-icon">âœ“</span> End Session';
      }
      
      renderUserTable();
    }

    // End session
    function endSession() {
      // Save speaking duration for last user
      if (currentUser !== null && currentUserStartTime !== null) {
        const duration = Math.floor((Date.now() - currentUserStartTime) / 1000);
        speakingDurations[currentUser] = duration;
      }

      // Mark last user as done if not already
      if (currentUser !== null && !doneUsers.includes(currentUser)) {
        doneUsers.push(currentUser);
      }

      sessionActive = false;
      currentUserStartTime = null;
      stopTimer();
      
      pickBtn.disabled = true;
      pickerUser.style.display = 'none';
      pickerDisplay.classList.remove('spinning', 'selected');
      pickerDisplay.style.display = 'none';
      document.querySelector('.timer-section').style.display = 'none';
      
      // Show random quote
      const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById('completeQuote').textContent = `"${randomQuote}"`;
      
      sessionComplete.classList.add('show');
      
      renderUserTable();
      updateProgress();
    }

    // Reset session
    function resetSession() {
      sessionActive = false;
      stopTimer();
      
      remainingUsers = [];
      doneUsers = [];
      currentUser = null;
      currentUserStartTime = null;
      timeRemaining = 15 * 60;
      
      // Reset speaking durations
      users.forEach((_, index) => {
        speakingDurations[index] = 0;
      });
      
      // Assign new random avatars for next session
      assignRandomAvatars();

      startBtn.style.display = 'flex';
      resetBtn.style.display = 'none';
      pickBtn.style.display = 'none';
      pickBtn.disabled = true;
      pickBtn.innerHTML = '<span class="btn-icon">ðŸŽ²</span> Pick a member';
      sessionComplete.classList.remove('show');
      
      // Restore timer and picker display
      document.querySelector('.timer-section').style.display = 'block';
      pickerDisplay.style.display = 'flex';
      
      pickerPlaceholder.textContent = 'Click "Start Session" to begin';
      pickerPlaceholder.style.display = 'block';
      pickerUser.style.display = 'none';
      pickerDisplay.classList.remove('spinning', 'selected');
      spinOverlay.classList.remove('active');

      updateTimerDisplay();
      renderUserTable();
      updateProgress();
    }

    // Event Listeners
    startBtn.addEventListener('click', startSession);
    pickBtn.addEventListener('click', spinAndPickUser);
    resetBtn.addEventListener('click', resetSession);

    // Initialize
    loadUsers();
  </script>
</body>
</html>
